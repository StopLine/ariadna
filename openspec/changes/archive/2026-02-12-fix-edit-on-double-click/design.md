## Context

Текущая реализация `NodeDetailTreeProvider` устанавливает `command` на `TreeItem` для полей `caption` (строка 214-217) и комментариев (строка 207-211) в `src/extension.ts`. VS Code вызывает команды при одинарном клике, что не соответствует ожиданиям пользователей.

VS Code TreeView API не предоставляет встроенного события "onDoubleClick". Нужно реализовать определение двойного клика через стандартные события.

## Goals / Non-Goals

**Goals:**
- Запускать редактирование caption/комментариев только по двойному клику
- Сохранить одинарный клик для навигации и отображения деталей узла
- Использовать только публичные API VS Code (без хаков)

**Non-Goals:**
- Изменение поведения других элементов дерева (srcLink, visualMarks)
- Настраиваемая задержка двойного клика (используем системное значение ~300ms)
- Поддержка редактирования через клавиатуру (оставляем на будущее)

## Decisions

### Decision 1: Использовать TreeView.onDidChangeSelection для определения двойного клика

**Подход:** Убрать `command` из TreeItem для caption/комментариев. Подписаться на событие `TreeView.onDidChangeSelection` и отслеживать временные интервалы между выборами одного элемента.

**Алгоритм:**
```
lastSelection = { item: null, timestamp: 0 }

onDidChangeSelection(event):
  if event.selection[0] === lastSelection.item:
    if (now - lastSelection.timestamp) < DOUBLE_CLICK_THRESHOLD:
      // Двойной клик обнаружен
      trigger edit command
      lastSelection.item = null  // reset
      return

  // Первый клик или другой элемент
  lastSelection = { item: event.selection[0], timestamp: now }
```

**Альтернативы рассмотрены:**
- **Context menu "Edit"** — отклонено: правый клик, а не двойной
- **Кастомный webview** — отклонено: излишне сложно, потеря нативного UI
- **Polling selection** — отклонено: неэффективно, нет событий между кликами

**Rationale:** Событие selection срабатывает при каждом клике. Отслеживание времени между кликами на один элемент — стандартный способ эмуляции двойного клика.

### Decision 2: Threshold для двойного клика = 300ms

Стандартное системное значение для большинства ОС. Константа в коде для возможности настройки в будущем.

### Decision 3: Сохранить contextValue для будущих расширений

Оставить `contextValue` на элементах для возможности добавления контекстного меню в будущем (например, "Edit" как альтернатива).

## Risks / Trade-offs

- **Риск:** Пользователь может случайно запустить редактирование при быстром переключении между элементами
  → **Смягчение:** Threshold 300ms достаточен для различения навигации и намеренного двойного клика; сбрасываем lastSelection при смене элемента

- **Риск:** VS Code может не генерировать selection event при некоторых кликах
  → **Смягчение:** Тестирование на разных платформах; fallback через context menu в крайнем случае

- **Trade-off:** Дополнительное состояние в extension (lastSelection)
  → **Приемлемо:** Минимальный overhead, нет утечек памяти при правильной реализации
